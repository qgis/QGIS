/***************************************************************************
  qgstextcodec.cpp - QgsTextCodec

 ---------------------
 begin                : 12.1.2026
 copyright            : (C) 2026 by Jan Dalheimer
 email                : jan@dalheimer.de
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/

#include "qgstextcodec.h"

#include "qgslogger.h"

// this contains all encoding names from QTextCodec (Qt 5) that are not available in QStringConverter (Qt 6+)
static QHash<QString, QString> sOldToNewEncoding =
{
  { "037", "" },
  { "1026", "" },
  { "1047", "" },
  { "1089", "" },
  { "1383", "" },
  { "273", "" },
  { "277", "" },
  { "278", "" },
  { "280", "" },
  { "284", "" },
  { "285", "" },
  { "297", "" },
  { "420", "" },
  { "424", "" },
  { "437", "" },
  { "500", "" },
  { "5601", "" },
  { "5601", "" },
  { "646", "" },
  { "775", "" },
  { "819", "" },
  { "838", "" },
  { "850", "" },
  { "851", "" },
  { "852", "" },
  { "855", "" },
  { "857", "" },
  { "860", "" },
  { "861", "" },
  { "862", "" },
  { "863", "" },
  { "865", "" },
  { "866", "" },
  { "868", "" },
  { "869", "" },
  { "871", "" },
  { "8859_1", "" },
  { "8859_13", "" },
  { "8859_15", "" },
  { "8859_2", "" },
  { "8859_3", "" },
  { "8859_4", "" },
  { "8859_5", "" },
  { "8859_6", "" },
  { "8859_7", "" },
  { "8859_8", "" },
  { "8859_9", "" },
  { "912", "" },
  { "913", "" },
  { "914", "" },
  { "915", "" },
  { "920", "" },
  { "921", "" },
  { "923", "" },
  { "970", "" },
  { "ansi1251", "windows-1251" },
  { "ansi_x3.4-1968", "" },
  { "ansi_x3.4-1986", "" },
  { "arabic", "" },
  { "ascii", "us-ascii" },
  { "ascii7", "" },
  { "asmo-708", "" },
  { "big5hk", "" },
  { "ccsid00858", "" },
  { "ccsid01140", "" },
  { "ccsid01141", "" },
  { "ccsid01142", "" },
  { "ccsid01143", "" },
  { "ccsid01144", "" },
  { "ccsid01145", "" },
  { "ccsid01146", "" },
  { "ccsid01147", "" },
  { "ccsid01148", "" },
  { "ccsid01149", "" },
  { "chinese", "" },
  { "cp-ar", "" },
  { "cp-gr", "" },
  { "cp-is", "" },
  { "cp00858", "" },
  { "cp01140", "" },
  { "cp01141", "" },
  { "cp01142", "" },
  { "cp01143", "" },
  { "cp01144", "" },
  { "cp01145", "" },
  { "cp01146", "" },
  { "cp01147", "" },
  { "cp01148", "" },
  { "cp01149", "" },
  { "cp037", "" },
  { "cp1026", "" },
  { "cp1047", "" },
  { "cp1089", "" },
  { "cp1140", "" },
  { "cp1141", "" },
  { "cp1142", "" },
  { "cp1143", "" },
  { "cp1144", "" },
  { "cp1145", "" },
  { "cp1146", "" },
  { "cp1147", "" },
  { "cp1148", "" },
  { "cp1149", "" },
  { "cp1200", "" },
  { "cp1201", "" },
  { "cp1208", "" },
  { "cp1250", "windows-1250" },
  { "cp1251", "windows-1251" },
  { "cp1252", "windows-1252" },
  { "cp1253", "windows-1253" },
  { "cp1254", "windows-1254" },
  { "cp1255", "windows-1255" },
  { "cp1256", "windows-1256" },
  { "cp1257", "windows-1258" },
  { "cp1258", "" },
  { "cp1383", "" },
  { "cp273", "" },
  { "cp277", "" },
  { "cp278", "" },
  { "cp280", "" },
  { "cp284", "" },
  { "cp285", "" },
  { "cp290", "" },
  { "cp297", "" },
  { "cp367", "" },
  { "cp37", "" },
  { "cp420", "" },
  { "cp424", "" },
  { "cp437", "" },
  { "cp500", "" },
  { "cp775", "" },
  { "cp819", "" },
  { "cp838", "" },
  { "cp850", "" },
  { "cp852", "" },
  { "cp855", "" },
  { "cp857", "" },
  { "cp858", "" },
  { "cp860", "" },
  { "cp861", "" },
  { "cp862", "" },
  { "cp863", "" },
  { "cp864", "" },
  { "cp865", "" },
  { "cp866", "" },
  { "cp868", "" },
  { "cp869", "" },
  { "cp870", "" },
  { "cp871", "" },
  { "cp878", "" },
  { "cp912", "" },
  { "cp913", "" },
  { "cp914", "" },
  { "cp915", "" },
  { "cp918", "" },
  { "cp920", "" },
  { "cp921", "" },
  { "cp923", "" },
  { "cp932", "" },
  { "cp936", "" },
  { "cp943c", "" },
  { "cp970", "" },
  { "cpibm284", "" },
  { "cpibm285", "" },
  { "cpibm297", "" },
  { "cpibm37", "" },
  { "csadobestandardencoding", "adobe-standard-encoding" },
  { "csascii", "" },
  { "csbig5", "big5" },
  { "csbocu-1", "" },
  { "cseuckr", "" },
  { "cseucpkdfmtjapanese", "" },
  { "csgb2312", "gb2312" },
  { "cshproman8", "hp-roman8" },
  { "csibm037", "ibm037" },
  { "csibm1026", "ibm1026" },
  { "csibm273", "ibm273" },
  { "csibm277", "ibm277" },
  { "csibm278", "ibm278" },
  { "csibm280", "ibm280" },
  { "csibm284", "ibm284" },
  { "csibm285", "ibm285" },
  { "csibm290", "ibm290" },
  { "csibm297", "ibm297" },
  { "csibm420", "ibm420" },
  { "csibm424", "ibm424" },
  { "csibm500", "ibm500" },
  { "csibm855", "ibm855" },
  { "csibm857", "ibm857" },
  { "csibm860", "ibm860" },
  { "csibm861", "ibm861" },
  { "csibm863", "ibm863" },
  { "csibm864", "ibm864" },
  { "csibm865", "ibm865" },
  { "csibm866", "ibm866" },
  { "csibm868", "ibm868" },
  { "csibm869", "ibm869" },
  { "csibm870", "ibm870" },
  { "csibm871", "ibm871" },
  { "csibm918", "ibm918" },
  { "csibmthai", "" },
  { "csiso2022cn", "" },
  { "csiso2022jp", "" },
  { "csiso2022jp2", "" },
  { "csiso2022kr", "" },
  { "csiso58gb231280", "" },
  { "csisolatin0", "" },
  { "csisolatin1", "" },
  { "csisolatin2", "" },
  { "csisolatin3", "" },
  { "csisolatin4", "" },
  { "csisolatin5", "" },
  { "csisolatin6", "" },
  { "csisolatin9", "" },
  { "csisolatinarabic", "" },
  { "csisolatincyrillic", "" },
  { "csisolatingreek", "" },
  { "csisolatinhebrew", "" },
  { "csjisencoding", "" },
  { "cskoi8r", "" },
  { "csksc56011987", "" },
  { "csksc56011987", "" },
  { "csmacintosh", "macintosh" },
  { "cspc775baltic", "" },
  { "cspc850multilingual", "" },
  { "cspc851", "" },
  { "cspc862latinhebrew", "" },
  { "cspc8codepage437", "" },
  { "cspcp852", "" },
  { "cspcp855", "" },
  { "csshiftjis", "" },
  { "csucs4", "" },
  { "csunicode", "" },
  { "cswindows31j", "" },
  { "cyrillic", "" },
  { "dos-862", "" },
  { "ebcdic-cp-ar1", "" },
  { "ebcdic-cp-ar2", "" },
  { "ebcdic-cp-be", "" },
  { "ebcdic-cp-ca", "" },
  { "ebcdic-cp-ch", "" },
  { "ebcdic-cp-dk", "" },
  { "ebcdic-cp-es", "" },
  { "ebcdic-cp-fi", "" },
  { "ebcdic-cp-fr", "" },
  { "ebcdic-cp-gb", "" },
  { "ebcdic-cp-he", "" },
  { "ebcdic-cp-is", "" },
  { "ebcdic-cp-it", "" },
  { "ebcdic-cp-nl", "" },
  { "ebcdic-cp-no", "" },
  { "ebcdic-cp-roece", "" },
  { "ebcdic-cp-se", "" },
  { "ebcdic-cp-us", "" },
  { "ebcdic-cp-wt", "" },
  { "ebcdic-cp-yu", "" },
  { "ebcdic-de", "" },
  { "ebcdic-de-273+euro", "" },
  { "ebcdic-dk", "" },
  { "ebcdic-dk-277+euro", "" },
  { "ebcdic-es-284+euro", "" },
  { "ebcdic-fi-278+euro", "" },
  { "ebcdic-fr-297+euro", "" },
  { "ebcdic-gb", "" },
  { "ebcdic-gb-285+euro", "" },
  { "ebcdic-international-500+euro", "" },
  { "ebcdic-is", "" },
  { "ebcdic-is-871+euro", "" },
  { "ebcdic-it-280+euro", "" },
  { "ebcdic-jp-kana", "" },
  { "ebcdic-no-277+euro", "" },
  { "ebcdic-se-278+euro", "" },
  { "ebcdic-sv", "" },
  { "ebcdic-us-37+euro", "" },
  { "ecma-114", "" },
  { "ecma-118", "" },
  { "ecma-128", "" },
  { "elot_928", "" },
  { "euc-cn", "" },
  { "euc-jp-2007", "" },
  { "eucjis", "" },
  { "extended_unix_code_packed_format_for_japanese", "" },
  { "gb18030-2022", "" },
  { "gb2312-1980", "gb_2312-80" },
  { "gb2312.1980-0", "" },
  { "greek", "" },
  { "greek8", "" },
  { "hebrew", "" },
  { "hebrew8", "" },
  { "hkscs-big5", "big5-hkscs" },
  { "hp15cn", "" },
  { "hz", "" },
  { "ibm-037", "ibm037" },
  { "ibm-1026", "ibm1026" },
  { "ibm-1026_p100-1995", "" },
  { "ibm-1047", "ibm1047" },
  { "ibm-1047_p100-1995", "" },
  { "ibm-1051", "" },
  { "ibm-1051_p100-1995", "" },
  { "ibm-1089", "" },
  { "ibm-1089_p100-1995", "" },
  { "ibm-1140", "" },
  { "ibm-1140_p100-1997", "" },
  { "ibm-1141", "" },
  { "ibm-1141_p100-1997", "" },
  { "ibm-1142", "" },
  { "ibm-1142_p100-1997", "" },
  { "ibm-1143", "" },
  { "ibm-1143_p100-1997", "" },
  { "ibm-1144", "" },
  { "ibm-1144_p100-1997", "" },
  { "ibm-1145", "" },
  { "ibm-1145_p100-1997", "" },
  { "ibm-1146", "" },
  { "ibm-1146_p100-1997", "" },
  { "ibm-1147", "" },
  { "ibm-1147_p100-1997", "" },
  { "ibm-1148", "" },
  { "ibm-1148_p100-1997", "" },
  { "ibm-1149", "" },
  { "ibm-1149_p100-1997", "" },
  { "ibm-1168", "" },
  { "ibm-1168_p100-2002", "" },
  { "ibm-1200", "" },
  { "ibm-1201", "" },
  { "ibm-1202", "" },
  { "ibm-1203", "" },
  { "ibm-1204", "" },
  { "ibm-1205", "" },
  { "ibm-1208", "" },
  { "ibm-1209", "" },
  { "ibm-1212", "" },
  { "ibm-1213", "" },
  { "ibm-1214", "" },
  { "ibm-1215", "" },
  { "ibm-1232", "" },
  { "ibm-1233", "" },
  { "ibm-1234", "" },
  { "ibm-1235", "" },
  { "ibm-1236", "" },
  { "ibm-1237", "" },
  { "ibm-1276", "" },
  { "ibm-1276_p100-1995", "" },
  { "ibm-13488", "" },
  { "ibm-13489", "" },
  { "ibm-13490", "" },
  { "ibm-13491", "" },
  { "ibm-13496", "" },
  { "ibm-13497", "" },
  { "ibm-1363", "" },
  { "ibm-1363_p11b-1998", "" },
  { "ibm-1363_vsub_vpua", "" },
  { "ibm-1375", "" },
  { "ibm-1375_p100-2008", "" },
  { "ibm-1383", "" },
  { "ibm-1383_p110-1999", "" },
  { "ibm-1383_vpua", "" },
  { "ibm-1392", "" },
  { "ibm-17584", "" },
  { "ibm-17585", "" },
  { "ibm-17586", "" },
  { "ibm-17587", "" },
  { "ibm-17592", "" },
  { "ibm-17593", "" },
  { "ibm-21680", "" },
  { "ibm-21681", "" },
  { "ibm-21682", "" },
  { "ibm-21683", "" },
  { "ibm-25776", "" },
  { "ibm-25777", "" },
  { "ibm-25778", "" },
  { "ibm-25779", "" },
  { "ibm-273", "ibm273" },
  { "ibm-273_p100-1995", "" },
  { "ibm-277", "ibm277" },
  { "ibm-277_p100-1995", "" },
  { "ibm-278", "ibm278" },
  { "ibm-278_p100-1995", "" },
  { "ibm-280", "ibm280" },
  { "ibm-280_p100-1995", "" },
  { "ibm-284", "ibm284" },
  { "ibm-284_p100-1995", "" },
  { "ibm-285", "ibm285" },
  { "ibm-285_p100-1995", "" },
  { "ibm-290", "ibm290" },
  { "ibm-290_p100-1995", "" },
  { "ibm-297", "ibm297" },
  { "ibm-297_p100-1995", "" },
  { "ibm-29872", "" },
  { "ibm-29873", "" },
  { "ibm-29874", "" },
  { "ibm-29875", "" },
  { "ibm-367", "" },
  { "ibm-37", "" },
  { "ibm-37_p100-1995", "" },
  { "ibm-420", "ibm420" },
  { "ibm-420_x120-1999", "" },
  { "ibm-424", "ibm424" },
  { "ibm-424_p100-1995", "" },
  { "ibm-437", "ibm437" },
  { "ibm-437_p100-1995", "" },
  { "ibm-500", "ibm500" },
  { "ibm-500_p100-1995", "" },
  { "ibm-5012", "" },
  { "ibm-5012_p100-1999", "" },
  { "ibm-5054", "" },
  { "ibm-5304", "" },
  { "ibm-5305", "" },
  { "ibm-5346", "" },
  { "ibm-5346_p100-1998", "" },
  { "ibm-5347", "" },
  { "ibm-5347_p100-1998", "" },
  { "ibm-5348", "" },
  { "ibm-5348_p100-1997", "" },
  { "ibm-5349", "" },
  { "ibm-5349_p100-1998", "" },
  { "ibm-5350", "" },
  { "ibm-5350_p100-1998", "" },
  { "ibm-5354", "" },
  { "ibm-5354_p100-1998", "" },
  { "ibm-5478", "" },
  { "ibm-5478_p100-1995", "" },
  { "ibm-61955", "" },
  { "ibm-61956", "" },
  { "ibm-775", "ibm775" },
  { "ibm-775_p100-1996", "" },
  { "ibm-819", "" },
  { "ibm-838", "" },
  { "ibm-838_p100-1995", "" },
  { "ibm-850", "ibm850" },
  { "ibm-850_p100-1995", "" },
  { "ibm-851", "" },
  { "ibm-851_p100-1995", "" },
  { "ibm-852", "ibm852" },
  { "ibm-852_p100-1995", "" },
  { "ibm-855", "ibm855" },
  { "ibm-855_p100-1995", "" },
  { "ibm-857", "ibm857" },
  { "ibm-857_p100-1995", "" },
  { "ibm-858", "" },
  { "ibm-858_p100-1997", "" },
  { "ibm-860", "ibm860" },
  { "ibm-860_p100-1995", "" },
  { "ibm-861", "ibm861" },
  { "ibm-861_p100-1995", "" },
  { "ibm-862", "ibm862" },
  { "ibm-862_p100-1995", "" },
  { "ibm-863", "ibm863" },
  { "ibm-863_p100-1995", "" },
  { "ibm-864", "ibm864" },
  { "ibm-864_x110-1999", "" },
  { "ibm-865", "ibm865" },
  { "ibm-865_p100-1995", "" },
  { "ibm-866", "ibm866" },
  { "ibm-866_p100-1995", "" },
  { "ibm-868", "ibm868" },
  { "ibm-868_p100-1995", "" },
  { "ibm-869", "ibm869" },
  { "ibm-869_p100-1995", "" },
  { "ibm-870", "ibm870" },
  { "ibm-870_p100-1995", "" },
  { "ibm-871", "ibm871" },
  { "ibm-871_p100-1995", "" },
  { "ibm-878", "" },
  { "ibm-878_p100-1996", "" },
  { "ibm-9005", "" },
  { "ibm-9005_x110-2007", "" },
  { "ibm-9030", "" },
  { "ibm-912", "" },
  { "ibm-912_p100-1995", "" },
  { "ibm-913", "" },
  { "ibm-913_p100-2000", "" },
  { "ibm-914", "" },
  { "ibm-914_p100-1995", "" },
  { "ibm-915", "" },
  { "ibm-915_p100-1995", "" },
  { "ibm-918", "ibm918" },
  { "ibm-918_p100-1995", "" },
  { "ibm-920", "" },
  { "ibm-920_p100-1995", "" },
  { "ibm-921", "" },
  { "ibm-921_p100-1995", "" },
  { "ibm-923", "" },
  { "ibm-923_p100-1998", "" },
  { "ibm-9400", "" },
  { "ibm-9424", "" },
  { "ibm-943", "" },
  { "ibm-943_p15a-2003", "" },
  { "ibm-943_vsub_vpua", "" },
  { "ibm-943c", "" },
  { "ibm-9447", "" },
  { "ibm-9447_p100-2002", "" },
  { "ibm-9448", "" },
  { "ibm-9448_x100-2005", "" },
  { "ibm-9449", "" },
  { "ibm-9449_p100-2002", "" },
  { "ibm-970", "" },
  { "ibm-970_p110_p110-2006_u2", "" },
  { "ibm-970_vpua", "" },
  { "ibm-euccn", "" },
  { "ibm-euckr", "" },
  { "ibm367", "" },
  { "ibm819", "" },
  { "ibm838", "" },
  { "ibm851", "" },
  { "iso-10646-ucs-2", "" },
  { "iso-10646-ucs-4", "" },
  { "iso-8859-6-e", "" },
  { "iso-8859-6-i", "" },
  { "iso-8859-8-e", "" },
  { "iso-8859-8-i", "" },
  { "iso-8859_10-1998", "" },
  { "iso-8859_14-1998", "" },
  { "iso-celtic", "" },
  { "iso-ir-100", "" },
  { "iso-ir-101", "" },
  { "iso-ir-109", "" },
  { "iso-ir-110", "" },
  { "iso-ir-126", "" },
  { "iso-ir-127", "" },
  { "iso-ir-138", "" },
  { "iso-ir-144", "" },
  { "iso-ir-148", "" },
  { "iso-ir-149", "" },
  { "iso-ir-149", "" },
  { "iso-ir-157", "" },
  { "iso-ir-199", "" },
  { "iso-ir-58", "" },
  { "iso-ir-6", "" },
  { "iso646-us", "" },
  { "iso8859_15_fdis", "" },
  { "iso_2022,locale=ja,version=0", "" },
  { "iso_2022,locale=ja,version=1", "" },
  { "iso_2022,locale=ja,version=2", "" },
  { "iso_2022,locale=ko,version=0", "" },
  { "iso_2022,locale=zh,version=0", "" },
  { "iso_2022,locale=zh,version=1", "" },
  { "iso_646.irv:1983", "" },
  { "iso_646.irv:1991", "" },
  { "iso_8859-10:1992", "" },
  { "iso_8859-14:1998", "" },
  { "iso_8859-1:1987", "" },
  { "iso_8859-2:1987", "" },
  { "iso_8859-3:1988", "" },
  { "iso_8859-4:1988", "" },
  { "iso_8859-5:1988", "" },
  { "iso_8859-6:1987", "" },
  { "iso_8859-7:1987", "" },
  { "iso_8859-8:1988", "" },
  { "iso_8859-9:1989", "" },
  { "jis", "" },
  { "jis_encoding", "" },
  { "koi8", "" },
  { "korean", "" },
  { "korean", "" },
  { "ks_c_5601-1987", "" },
  { "ks_c_5601-1987", "" },
  { "ks_c_5601-1987", "" },
  { "ks_c_5601-1989", "" },
  { "ks_c_5601-1989", "" },
  { "ksc", "" },
  { "l1", "" },
  { "l2", "" },
  { "l3", "" },
  { "l4", "" },
  { "l5", "" },
  { "l6", "" },
  { "l8", "" },
  { "l9", "" },
  { "latin-9", "" },
  { "latin0", "" },
  { "latin1", "" },
  { "latin2", "" },
  { "latin3", "" },
  { "latin4", "" },
  { "latin5", "" },
  { "latin6", "" },
  { "latin8", "" },
  { "mac", "macintosh" },
  { "mac-cyrillic", "" },
  { "macce", "" },
  { "maccentraleurope", "" },
  { "maccy", "" },
  { "macgr", "" },
  { "macos-0_2-10.2", "" },
  { "macos-29-10.2", "" },
  { "macos-35-10.2", "" },
  { "macos-6_2-10.4", "" },
  { "macos-7_3-10.2", "" },
  { "macroman", "" },
  { "mactr", "" },
  { "ms874", "" },
  { "ms932", "" },
  { "ms936", "" },
  { "ms949", "" },
  { "ms950", "" },
  { "ms_kanji", "" },
  { "pc-multilingual-850+euro", "" },
  { "pck", "" },
  { "r8", "" },
  { "roman8", "" },
  { "sjis", "" },
  { "sun_eu_greek", "" },
  { "tscii", "" },
  { "turkish", "" },
  { "turkish8", "" },
  { "ucs-2", "" },
  { "ucs-4", "" },
  { "ujis", "" },
  { "unicode", "" },
  { "unicode-1-1-utf-7", "" },
  { "unicode-1-1-utf-8", "" },
  { "unicode-2-0-utf-7", "" },
  { "unicode-2-0-utf-8", "" },
  { "unicodebigunmarked", "" },
  { "unicodelittleunmarked", "" },
  { "us", "" },
  { "utf16_bigendian", "utf-16be" },
  { "utf16_littleendian", "utf-16le" },
  { "utf32_bigendian", "utf-32be" },
  { "utf32_littleendian", "utf-32le" },
  { "windows-10000", "" },
  { "windows-10006", "" },
  { "windows-10007", "" },
  { "windows-10029", "" },
  { "windows-10081", "" },
  { "windows-1200", "" },
  { "windows-1201", "" },
  { "windows-20127", "" },
  { "windows-20866", "" },
  { "windows-21866", "" },
  { "windows-28592", "" },
  { "windows-28593", "" },
  { "windows-28594", "" },
  { "windows-28595", "" },
  { "windows-28596", "" },
  { "windows-28597", "" },
  { "windows-28598", "" },
  { "windows-28599", "" },
  { "windows-28603", "" },
  { "windows-28605", "" },
  { "windows-31j", "" },
  { "windows-437", "" },
  { "windows-51949", "" },
  { "windows-54936", "" },
  { "windows-65000", "" },
  { "windows-65001", "" },
  { "windows-775", "" },
  { "windows-850", "" },
  { "windows-852", "" },
  { "windows-855", "" },
  { "windows-857", "" },
  { "windows-858", "" },
  { "windows-861", "" },
  { "windows-862", "" },
  { "windows-866", "" },
  { "windows-869", "" },
  { "windows-874", "" },
  { "windows-932", "" },
  { "windows-936", "" },
  { "windows-936-2000", "" },
  { "windows-949", "" },
  { "windows-949", "" },
  { "windows-949-2000", "" },
  { "windows-950", "" },
  { "windows-950-2000", "" },
  { "x-big5", "" },
  { "x-euc-jp", "" },
  { "x-ibm1363c", "" },
  { "x-ibm921", "" },
  { "x-ibm970", "" },
  { "x-iso-2022-cn-gb", "" },
  { "x-iso-8859-6s", "" },
  { "x-jisautodetect", "" },
  { "x-ksc5601", "" },
  { "x-mac-ce", "" },
  { "x-maccentraleurope", "" },
  { "x-maccyrillic", "x-mac-cyrillic" },
  { "x-macgreek", "x-mac-greek" },
  { "x-macroman", "" },
  { "x-macturkish", "x-mac-turkish" },
  { "x-macukraine", "" },
  { "x-ms-cp932", "" },
  { "x-ms932_0213", "" },
  { "x-roman8", "" },
  { "x-sjis", "shift_jis" },
  { "x-utf-16be", "utf-16be" },
  { "x-utf-16le", "utf-16le" },
  { "x-utf_8j", "" },
  { "x-windows-1256s", "" },
  { "x-windows-50220", "" },
  { "x-windows-50221", "" },
  { "x-windows-874", "" },
  { "x-windows-950", "" },
  { "x-windows-iso2022jp", "" },
};

QgsTextCodec::QgsTextCodec( const QStringConverter::Encoding encoding )
  : mEncoding( encoding )
{
}

QgsTextCodec::QgsTextCodec( QTextCodec *codec )
  : mEncoding( codec->name() )
{
}

QgsTextCodec::QgsTextCodec( const QString &encoding )
  : mEncoding( encoding )
{
}
std::optional<QgsTextCodec> QgsTextCodec::fromName( const QString &encoding )
{
  if ( encoding.toLower() == "system"_L1 )
  {
    // backwards-compatibility - QStringConverter::availableCodecs() does not return "System"
    return std::make_optional( QStringConverter::Encoding::System );
  }
  else if ( encoding.toLower().replace( '-', "" ) == "latin1"_L1 )
  {
    // backwards-compatibility - QStringConverter::availableCodecs() does not return "latin1"
    return std::make_optional( QStringConverter::Encoding::Latin1 );
  }
  else if ( sOldToNewEncoding.contains( encoding.toLower() ) )
  {
    // backwards-compatibility - handle encoding names that QTextCodec supported
    const QString mapped = sOldToNewEncoding.value( encoding.toLower() );
    if ( mapped.isEmpty() )
    {
      QgsDebugMsgLevel( u"attempting to load legacy encoding without mapping to new system: %1"_s.arg( encoding ), 1 );
      return {};
    }
    return std::make_optional( QgsTextCodec( mapped ) );
  }
  else if ( const int idx = QStringConverter::availableCodecs().indexOf( encoding, Qt::CaseInsensitive ); idx != -1 )
  {
    return std::make_optional( QgsTextCodec( QStringConverter::availableCodecs().at( idx ) ) );
  }
  else
  {
    return {};
  }
}
QStringList QgsTextCodec::availableCodecs()
{
  QStringList codecs = QStringConverter::availableCodecs();
  codecs.append( "system" );
  codecs.append( "latin1" );
  for ( const QString &codec : sOldToNewEncoding.keys() )
  {
    codecs.append( codec );
  }
  return codecs;
}

QString QgsTextCodec::name() const
{
  return std::visit( []( auto &&arg )
  {
    using T = std::decay_t<decltype( arg )>;
    if constexpr( std::is_same_v<T, QString> )
    {
      return arg;
    }
    else
    {
      return QString( QStringConverter::nameForEncoding( arg ) );
    }
  },
  mEncoding );
}

QString QgsTextCodec::decode( const QByteArrayView &a ) const
{
  QStringDecoder decoder = std::visit( []( auto &&arg )
  {
    using T = std::decay_t<decltype( encoding )>;
    if constexpr( std::is_same_v<T, std::shared_ptr<QgsBaseTextCodecInterface>> )
    {
      return encoding->decode( a );
    }
    else
    {
      QStringDecoder decoder( encoding, QStringDecoder::Flag::Stateless );
      return decoder.decode( a );
    }
  },
  mEncoding );
  const QString result = decoder.decode( a );
  if ( decoder.hasError() )
  {
    return QString();
  }
  return result;
}

QByteArray QgsTextCodec::encode( const QStringView &s ) const
{
  QStringEncoder decoder = std::visit( []( auto &&arg )
  {
    using T = std::decay_t<decltype( encoding )>;
    if constexpr( std::is_same_v<T, std::shared_ptr<QgsBaseTextCodecInterface>> )
    {
      return encoding->encode( s );
    }
    else
    {
      QStringEncoder encoder( encoding, QStringDecoder::Flag::Stateless );
      return encoder.encode( s );
    }
  },
  mEncoding );
  const QByteArray result = decoder.encode( s );
  if ( decoder.hasError() )
  {
    return QByteArray();
  }
  return result;
}
